#should be part of a 'tasks'
- name: Update and upgrade apt packages
  become: true
  apt:
    upgrade: yes
    update_cache: yes
  tags:
    - Update apt packages
 
- name: Installing Maven
  become: true
  apt:
    name: ['maven','default-jdk']
  tags:
    - Installing Dependencies

# If it doesn't work, see of -p option
- name: Downloading binaries
  get_url:
    url: https://www-us.apache.org/dist/maven/maven-3/3.6.0/binaries/apache-maven-3.6.0-bin.tar.gz 
    dest: /tmp 

- name: Unarchiving the downloaded binaries
  become: true
  unarchive:
    src: /tmp/apache-maven-3.6.0-bin.tar.gz
    dest: /opt/
    remote_src: yes

- name: Creating symlinks for the downloaded files
  become: true
  file:
    src: /opt/apache-maven-3.6.0
    dest: /opt/maven
    state: link

- name: Copying shell script to host machine for setting environment variables
  become: true
  copy:
    src: maven.sh
    dest: /etc/profile.d/maven.sh
    mode: 0777

- name: Executing the script
  become: true
  shell: /etc/profile.d/maven.sh
  #remote_src: yes
  
- name: Checking Maven Installation
  shell: mvn -version
  register: mvncheck

- name: Completing Maven Installation check
  debug:
    var: mvncheck.stdout

- name: Set root user password
  become: true
  shell: mysqladmin -u root -p'test' password ''
  args: 
    creates: .removedPassword.txt

- name: Getting iTrust Repository
  git: 
    repo: https://github.com/rayandasoriya/iTrust.git
    dest: /home/vagrant/iTrust
    force: yes

- name: Changing Permissions 
  file:
    path: "/home/vagrant/iTrust/iTrust2"
    mode: 0777

- name: Copy a "db.properties.template" file on the remote machine for editing
  copy:
    src: /home/vagrant/iTrust/iTrust2/src/main/java/db.properties.template
    dest: /home/vagrant/iTrust/iTrust2/src/main/java/db.properties
    remote_src: yes

- name: Deleting Old file of db
  file:
    path: /home/vagrant/iTrust/iTrust2/src/main/java/db.properties.template
    state: absent

#- name: Deleting Old file of email
#  file:
#    path: /home/vagrant/iTrust/iTrust2/src/main/java/email.properties.template
#    state: absent

- name: Copy a "email.properties.template" file on the remote machine for editing
  copy:
    src: /home/vagrant/iTrust/iTrust2/src/main/java/email.properties.template
    dest: /home/vagrant/iTrust/iTrust2/src/main/java/email.properties
    remote_src: yes

- name: Deleting Old file of email
  file: 
    path: /home/vagrant/iTrust/iTrust2/src/main/java/email.properties.template
    state: absent
