---
# tasks file for mongo-db
- name: Including variables.yml
  include_vars:
    file: variables.yml

- name: Import the public key used by the PMS
  apt_key: 
    keyserver: hkp://keyserver.ubuntu.com:80 
    id: 7F0CEB10 
    state: present

- name: Add MongoDB repository
  apt_repository: 
    repo: 'deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen'
    state: present

- name: install mongodb 
  apt: 
    pkg: mongodb 
    state: latest 
    update_cache: yes 

- name: Creating /data/db
  file: 
    path: /data/db
    state: directory
    mode: 0777

- name: Installing Python-Pip
  apt:
    name: ['python3-pip']
    state: latest
    
- name: Install the latest pymongo package
  pip: 
    name: pymongo==3.5.1 
    use_mirrors: no

- name: Create mongodb Database and User
  become: true
  mongodb_user:
    database: admin
    name: '{{mongo_checkbox_user}}'
    password: '{{mongo_admin_password}}'
    state: present
    roles: readWrite,dbAdmin,userAdmin

- name: Creating a sevice file 
  copy: 
    src: mongodb.service
    dest: /lib/systemd/system/mongodb.service
    mode: 0777

